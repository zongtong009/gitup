/*
BUILT_AT: 2020年6月30日 06:22
*/
!function(e){function t(t){for(var i,a,s=t[0],u=t[1],c=t[2],l=0,p=[];l<s.length;l++)a=s[l],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(e[i]=u[i]);for(f&&f(t);p.length;)p.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,s=1;s<n.length;s++){var u=n[s];0!==o[u]&&(i=!1)}i&&(r.splice(t--,1),e=a(a.s=n[0]))}return e}var i={},o={2:0},r=[];function a(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="//s2.hdslb.com/bfs/static/blive/blfe-message-navbar/";var s=("undefined"!=typeof self?self:this).webpackJsonp=("undefined"!=typeof self?self:this).webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var f=u;r.push([293,0,1]),n()}({205:function(e,t,n){},293:function(e,t,n){"use strict";n.r(t);var i=n(9),o=n.n(i),r=(n(205),n(33),n(97),n(14),n(50),n(28),n(65),n(4),n(66),n(18),n(43),n(134),n(44),n(3)),a=n.n(r),s=(n(45),n(10)),u=(n(40),{get:function(e){var t=""+document.cookie,n=t.indexOf(e+"=");if(-1==n||""==e)return"";var i=t.indexOf(";",n);return-1==i&&(i=t.length),unescape(t.substring(n+e.length+1,i))},set:function(e,t,n){n=void 0!==n?n:365;var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),document.cookie=e+"="+escape(t)+";expires="+i.toGMTString()+"; path=/; domain=.bilibili.com"},delete:function(e){this.set(e,"",-1)}}),c={"zh-CN":{replyMe:"回复我的",atMe:"@我的",praiseMe:"收到的赞",system:"系统通知",whisper:"我的消息"},"zh-TW":{replyMe:"回复我的",atMe:"@我的",praiseMe:"收到的讚",system:"系統通知",whisper:"我的消息"}};function f(e){return(t=u.get("LNG")||"zh-CN",c[t]||{})[e]||e;var t}function l(e,t,n,i,o,r,a){try{var s=e[r](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,o)}function p(e){return function(){var t=this,n=arguments;return new Promise(function(i,o){var r=e.apply(t,n);function a(e){l(r,i,o,a,s,"next",e)}function s(e){l(r,i,o,a,s,"throw",e)}a(void 0)})}}var d,m,y={data:function(){return{uid:"",notifyCounts:{at_me:0,reply_me:0,praise_me:0,notify_me:0,message:0},notifyType:0,showUnfollowedMsg:1,im_list:[{name:"reply_me",text:f("replyMe"),href:"//message.bilibili.com/#/reply"},{name:"at_me",text:f("atMe"),href:"//message.bilibili.com/#/at"},{name:"praise_me",text:f("praiseMe"),href:"//message.bilibili.com/#/love"},{name:"notify_me",text:f("system"),href:"//message.bilibili.com/#/system"},{name:"message",text:f("whisper"),href:"//message.bilibili.com/#/whisper"}]}},watch:{notifyCounts:{handler:function(){this.postMessage()},deep:!0},notifyType:function(){this.postMessage()}},mounted:(m=p(a.a.mark(function e(){var t=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.getUid(),this.getNotifyType(),this.getnotifyCounts()]);case 2:return e.next=4,this.getUnreadMessageCount(!0);case 4:setInterval(function(){t.getUnreadMessageCount()},6e4),window.addEventListener("storage",function(e){e.key==="imNotifyCounts".concat(t.uid)?t.notifyCounts=JSON.parse(e.newValue):e.key==="im_notify_type_".concat(t.uid)&&(t.notifyType=parseInt(e.newValue))});case 6:case"end":return e.stop()}},e,this)})),function(){return m.apply(this,arguments)}),methods:{getUid:function(){var e=this;return Object(s.a)({addPlatInfo:!0,url:"//api.bilibili.com/x/web-interface/nav",method:"get"}).then(function(t){e.uid=t.data.mid})},getUnreadMessageCount:(d=p(a.a.mark(function e(){var t,n,i,o=this,r=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=r.length>0&&void 0!==r[0]&&r[0],n=function(){var e=p(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.a)({addPlatInfo:!0,url:"//api.vc.bilibili.com/session_svr/v1/session_svr/single_unread",method:"get",data:{unread_type:0}}).then(function(e){return o.unfollowFold?e.data.follow_unread:e.data.follow_unread+e.data.unfollow_unread});case 2:o.notifyCounts.message=e.sent,localStorage.setItem("imNotifyCounts".concat(o.uid),JSON.stringify(o.notifyCounts)),localStorage.setItem("unreadApiRequestedBy".concat(o.uid,"At"),Date.now());case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),t?n():parseInt(localStorage.getItem("unreadApiRequestedBy".concat(this.uid,"At")))+6e4>Date.now()?(i=JSON.parse(localStorage.getItem("imNotifyCounts".concat(this.uid)))||{},this.notifyCounts.message=parseInt(i.message)||0):n();case 3:case"end":return e.stop()}},e,this)})),function(){return d.apply(this,arguments)}),getnotifyCounts:function(){var e=this;return Object(s.a)({addPlatInfo:!0,url:"//api.bilibili.com/x/msgfeed/unread",method:"get"}).then(function(t){0===t.code&&(e.notifyCounts=Object.assign(e.notifyCounts,{at_me:t.data.at,reply_me:t.data.reply,praise_me:t.data.like,notify_me:t.data.sys_msg}))})},getNotifyType:function(){var e=this;return Object(s.a)({addPlatInfo:!0,url:"//api.vc.bilibili.com/link_setting/v1/link_setting/get",method:"get",data:{msg_notify:1,show_unfollowed_msg:1}}).then(function(t){0===t.code&&(e.notifyType=t.data.msg_notify,e.unfollowFold=1===Number(t.data.show_unfollowed_msg))})},postMessage:function(){var e=this,t=Object.keys(this.notifyCounts).reduce(function(t,n){return t+e.notifyCounts[n]},0);window.parent.postMessage({type:"nav-im-update",count:t,notifyType:Math.max(this.notifyType-1,0)},"*")},displayCount:function(e){return e>99?"99+":e}}},h=n(0),g=Object(h.a)(y,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"im-root"},[n("div",{staticClass:"im-list-box"},e._l(e.im_list,function(t){return n("a",{key:t.name,staticClass:"im-list",attrs:{href:t.href,target:"_blank"}},[e._v("\n      "+e._s(t.text)+"\n      "),3!==e.notifyType&&e.notifyCounts[t.name]>0?n("span",{staticClass:"im-notify im-number im-center"},[e._v(e._s(e.displayCount(e.notifyCounts[t.name])))]):e._e()])}),0)])},[],!1,null,null,null).exports;o.a.config.productionTip=!1,new o.a({render:function(e){return e(g)}}).$mount("#nav-im-part")}});